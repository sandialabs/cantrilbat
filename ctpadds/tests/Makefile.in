#
#  Makefile.in: 
#     Makefile for vcsc
#
# $Id: Makefile.in,v 1.8 2010/07/10 01:44:39 hkmoffa Exp $
#
#
RM = /bin/rm -f
CP = /bin/cp -f -p
AR = ar
RANLIB = ranlib
F77 = g77
FTCHECK = -u
F77MLDRFLAGS =
CMLDRFLAGS =
MPIHOME  = /usr/local/mpich
MPI_INC = -I$(MPIHOME)/include
MPI_LIB = -L/usr/local/mpich/lib -lmpich -lpmpich
#
# Setup The Zuzax Interface
CANTERA_LIBDIR=@ct_libdir@
CANTERA_LIBS= -lcantera

CT_TRANSPORT_LIBDEP=$(CANTERA_LIBDIR)/libtransport.a

CANTERA_INCROOT=@ct_incroot@
# This link is to Cantera's install space
CT_INCROOT=@ct_incroot@

# Bring in the Zuzax includes through the .mak file
include $(CT_INCROOT)/zuzax/Zuzax.mak

# Define the include directories
INCLUDE_DIRS =  $(CANTERA_TOTAL_INCLUDES)

#
# Find the Build root for Cantera
#
CANTERA_BUILD_ROOT=@ctb_root@
#
# 
UTILSRC_DIR=../../util_src/src
UTILSRC_DEP=${UTILSRC_DIR}/libutil_src.a
UTILSRC_LIB=-L${UTILSRC_DIR} -lutil_src

#
# Set up the various local and global defines
#
LDEFINES = -DDEBUG -DDEBUG_HKM
#
# Set up the global include directory macro
#
INCLUDE_DIRS =  $(CANTERA_TOTAL_INCLUDES) \
               -I$(CANTERA_BUILD_ROOT)/Cantera/src/base \
               -I$(UTILSRC_DIR) 

ALT_INCLUDE_DIRS =  $(CANTERA_TOTAL_INCLUDES) \
                   -I$(CANTERA_BUILD_ROOT)/Cantera/src/base \
                   -I$(CANTERA_BUILD_ROOT)/Cantera/src/thermo \
                   -I$(UTILSRC_DIR)
#
# the C++ compiler
#
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
LCXX_FLAGS = @LCXX_FLAGS@
LCXX_END_LIBS = @LCXX_END_LIBS@
CXXLDR = $(CXX)
#
# C compiler
#
CC = @CC@
CFLAGS = @CXXFLAGS@
#
# Both the C and C++ compiler predefines
#
CCFLAGS =  $(GDEFINES) $(INCLUDE_DIRS) $(LDEFINES) 
CCALTFLAGS = $(GDEFINES) $(ALT_INCLUDE_DIRS) $(LDEFINES) 
#
CF77LDR =  #@F77@
CLIBS    = -lm
AR       = ar
RANLIB   = echo
F77      = @F77@
F77LDR  =  $(F77)
#
# C and CXX Loader flags to be used when a CXX main program
# is linked with fortran libraries or object files.
# -> Key issue is fortran IO
#
FXX = @F77@
FFLAGS_BSD   =
FLIB_BSD     =
GPROF    = -G


all:  DH_test DH_NM_test .dependsT

.SUFFIXES: .src .prj .d

.cpp.o:
	$(CXX) $(CXXFLAGS) $(CCFLAGS) -c $<

# 
# These classes compile against the Zuzax kernel
# format
#

importAllCTML.o: importAllCTML.cpp importAllCTML.h Makefile
	$(CXX) $(CXXFLAGS) $(CCALTFLAGS) -c $<

SolidKinetics.o: SolidKinetics.cpp SolidKinetics.h Makefile
	$(CXX) $(CXXFLAGS) $(CCALTFLAGS) -c $<

HKFT_PDSS.o: HKFT_PDSS.cpp HKFT_PDSS.h Makefile
	$(CXX) $(CXXFLAGS) $(CCALTFLAGS) -c $<


LDR = $(F77LDR)
LDRFLAGS = $(F77LDRFLAGS)
LDRFLAGS_DEBUG = -g -y $(FFLAGS_BSD)
INSTALL = $(CHEMKIN_HOME)/bin/bsdinstall.sh 


MDPLIB_DEP = $(UTILSRC_DIR)/libutil_src.a
MDPLIB     = -L$(UTILSRC_DIR) -lutil_src

CTBLAS_DEP = $(CANTERA_LIBDIR)/libctblas.a
CTBLAS    = -L$(CANTERA_LIBDIR) -lctblas

CTLIB_DEP  = $(CANTERA_LIBDIR)/libcantera.a 
CTLIB     =  -L$(CANTERA_LIBDIR) $(CANTERA_LIBS)

CTPADDS_DIR = ../src
CTPADDS_DEP = $(CTPADDS_DIR)/libctpadds.a
CTPADDS_LIB = -L$(CTPADDS_DIR) -lctpadds

BLAS_DEP=
BLAS = -L/usr/local/ACCESS/libraries/blas -lblas


###########################################################################
# section to set up depends
###########################################################################
DEPENDS = DH_test.d DH_NM_test.d

.cpp.d:
	g++ -MM $(CXXFLAGS) $(CCFLAGS)  -c $*.cpp > $*.d

$(DEPENDS): Makefile

############################################################################

DH_test: DH_test.o  \
	$(OBJ_CANTERA_ADDONS) $(CTLIB_DEP) Makefile $(CANTERA_CORE_LIBS_DEP) $(UTILSRC_DEP)
	$(CXXLDR) -o DH_test DH_test.o $(LCXX_FLAGS) $(LINK_OPTIONS) \
                  $(UTILSRC_LIB) \
                  $(CANTERA_TOTAL_LIBS)  \
                  $(LCXX_END_LIBS)

DH_NM_test: DH_NM_test.o  \
    $(OBJ_CANTERA_ADDONS) $(CTLIB_DEP) Makefile $(CANTERA_CORE_LIBS_DEP)  $(UTILSRC_DEP)
	$(CXXLDR) $(LCXX_FLAGS) $(FLIB_BSD) -o DH_NM_test \
                  DH_NM_test.o  \
                  -L.  $(CTLIB) $(MDPLIB) $(UTILSRC_LIB)  \
                  $(CTBLAS) $(LCXX_END_LIBS) 

cg_test: cg_noprecond.o cg_test.o vcs_allo.o Makefile \
    $(OBJ_CANTERA_ADDONS) $(CTLIB_DEP) Makefile $(CANTERA_CORE_LIBS_DEP)
	$(CLDR) $(LDRFLAGS) $(FLIB_BSD) -o cg_test \
	cg_noprecond.o cg_test.o vcs_allo.o $(LCXX_END_LIBS)

testCalcDens: testCalcDens.o  \
        $(OBJ_CANTERA_ADDONS) $(CTLIB_DEP) Makefile $(CANTERA_CORE_LIBS_DEP)
	$(CXXLDR) $(LCXX_FLAGS) $(FLIB_BSD) -o testCalcDens \
                  testCalcDens.o  \
                  -L.  $(CTLIB) $(MDPLIB)  \
                  $(CTBLAS) $(LCXX_END_LIBS) 

test:

depends:
	$(RM) *.d .dependsT
	@MAKE@ .dependsT
	touch .dependsT

.dependsT: $(DEPENDS) 
	cat *.d > .depends
	touch .dependsT

###########################################################################
#          INSTALL RULES
###########################################################################

ifeq ($(wildcard .depends), .depends)
include .depends
endif

clean:
	$(RM) *.o *.prj lib*.a ftn[012345]* save save.dat dum \
                   fort.* *%  core *.trace tmp* .depends .dependsT
	$(RM) ${PROG} 

clean_dist:
	(RM) *.o *.prj lib*.a ftn[012345]* save save.dat dum \
                   fort.* *%  core *.trace tmp* .depends .dependsT
	$(RM) ${PROG} 


