#!/bin/sh
#
#  Makefile.in: 
#     Makefile for multiple execution example in Electrode
#
#
#
# Copywrite 2004 Sandia Corporation. Under the terms of Contract
# DE-AC04-94AL85000, there is a non-exclusive license for use of this
# work by or on behalf of the U.S. Government. Export of this program
# may require a license from the United States Government.
#

.SUFFIXES: .d

TESTNAME = MCMB_Mao

PROGRAMS = MCMB MCMBThermo MCMBThermo_RSD_Override

DATA = ECsoln_ion.xml  Li_Metal.xml  MCMBAnode_electrode_extra.xml  MCMB_RedlichKister.xml \
       metal_Li_LiIon_electrons.xml MCMB.cpp MCMBThermo.cpp MCMBThermo_RSD_Override.cpp

BLESSED_FILES = MCMB_blessed.out  MCMBThermo_blessed.out  MCMBThermo_RSD_Override_blessed.out \
                thermo_blessed.csv 

##########################################################################
#           Setup The Zuzax Directory locations
#########################################################################

PURIFY=@PURIFY@

# These links are to Cantera's install space
CT_INCROOT =  @ct_incroot@

# Absolute top directory of the module
ABSTOP_DIR = @abs_top_builddir@
#
# Bring in the Zuzax includes through the .mak file
#
include $(CT_INCROOT)/zuzax/Zuzax.mak
#
# Utility directory -> use the one in the module
#
UTILSRC_DIR = ../../../util_src/src
UTILSRC_DEP = $(UTILSRC_DIR)/libutil_src.a
UTILSRC     = -L$(UTILSRC_DIR) -lutil_src
#
# Set up the Zuzax addition library
#
CTPADDS_DIR = ../../../ctpadds/src
CTPADDS_DEP = $(CTPADDS_DIR)/libctpadds.a
CTPADDS_LIB = -L$(CTPADDS_DIR) -lctpadds
#
# Set up the Zuzax Application Base directory
#
ELECTRODE_DIR = $(ABSTOP_DIR)/Electrode/src
ELECTRODE_DEP =   $(ELECTRODE_DIR)/libElectrode.a
ELECTRODE_LIB = -L$(ELECTRODE_DIR) -lElectrode
#
#########################################################################
# Set up the various local and global defines
########################################################################
LDEFINES = -DDEBUG 
GDEFINES =
#
# Set up the global include directory macro
#
INCLUDE_DIRS = $(ZUZAX_TOTAL_INCLUDES) -I$(ELECTRODE_DIR) -I$(UTILSRC_DIR)  -I$(CTPADDS_DIR) 

all: .depends MCMBThermo MCMB MCMBThermo_RSD_Override

LDR = $(F77LDR)
LDRFLAGS = $(F77LDRFLAGS)
LDRFLAGS_DEBUG = -g -y $(FFLAGS_BSD)

CCFLAGS =   $(LDEFINES) $(INCLUDE_DIRS) $(GDEFINES)


OBJ_TOTAL = MCMB.o MCMBThermo.o MCMBThermo_RSD_Override.o

############################################################################
# section to set up compiler rules
###########################################################################
#
# the C++ compiler
#
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
LCXX_FLAGS = @LCXX_FLAGS@
LCXX_END_LIBS = @LCXX_END_LIBS@
CXXLDR = $(CXX)
CFLAGS = @CXXFLAGS@
#
# The C++ compiler predefines
#
CCFLAGS = $(GDEFINES) $(INCLUDE_DIRS) $(LDEFINES) 
#
.cpp.o:
	$(PURIFY) $(CXX) $(CXXFLAGS) $(CCFLAGS) -c $<
#
############################################################################
#            Section to set up depends
############################################################################
#
DEPENDS = $(OBJ_TOTAL:.o=.d) 

.cpp.d:
	@CXX_DEPENDS@ $(CXXFLAGS) $(CCFLAGS) -c $*.cpp > $*.d

depends:
	$(RM) $(DEPENDS)
	$(MAKE) .depends

.depends: $(DEPENDS)
	cat *.d > .depends

test: 
	$(MAKE) -s
	@echo -n 'Checking need to run test ' $(TESTNAME) ': '
	@$(MAKE) -q -s  runGood ; ss=$$? ; if test $$ss = "0" ; then echo '   NOT NEEDED' ; else  $(MAKE) -s runGood ; fi

runGood: $(PROGRAMS) $(DATA) Makefile $(BLESSED_FILES)
	@echo 'RUNNING TEST ' $(TESTNAME)
	./runtest

rebaseline:
	cp MCMBThermo.out  MCMBThermo_blessed.out
	cp MCMBThermo_RSD_Override.out  MCMBThermo_RSD_Override_blessed.out
	cp thermo.csv thermo_blessed.csv

$(OBJ_TOTAL): Makefile
$(DEPENDS): Makefile
#
#######################################################################################################################
#                     SECTION TO SET UP PROGRAM RULES
#######################################################################################################################
#
MCMBThermo: MCMBThermo.o $(OBJ_ZUZAX_ADDONS) $(UTILSRC_DEP) \
               $(ZUZAX_CORE_LIBS_DEP) $(CTPADDS_DEP) $(ELECTRODE_DEP)
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o MCMBThermo MCMBThermo.o  \
	          $(OBJ_ZUZAX_ADDONS)  \
                  $(ELECTRODE_LIB) $(CTPADDS_LIB) $(UTILSRC) $(ZUZAX_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

MCMBThermo_RSD_Override: MCMBThermo_RSD_Override.o $(OBJ_ZUZAX_ADDONS) $(UTILSRC_DEP) \
               $(ZUZAX_CORE_LIBS_DEP) $(CTPADDS_DEP) $(ELECTRODE_DEP)
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o MCMBThermo_RSD_Override MCMBThermo_RSD_Override.o \
	          $(OBJ_ZUZAX_ADDONS)  \
                  $(ELECTRODE_LIB) $(CTPADDS_LIB) $(UTILSRC) $(ZUZAX_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

MCMB: MCMB.o
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o MCMB MCMB.o \
	          $(OBJ_ZUZAX_ADDONS)  \
                  $(ELECTRODE_LIB) $(CTPADDS_LIB) $(UTILSRC) $(ZUZAX_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

test_clean:
	$(RM) err_out.txt out.txt  MCMBThermo_RSD_Override.out MCMB.out diff_csv.txt diff_out.txt \
	      MCMBThermo.out runGood runBad  diff_out.txt diff_csv.txt

clean:
	$(MAKE) test_clean
	$(RM) *.o  .depends *.d *~  $(PROGRAMS) 
#
#############################################################################
#          DEPENDS INCLUDE
##############################################################################
#
ifeq ($(wildcard .depends), .depends)
include .depends
endif

