#!/bin/sh
#
# Copywrite 2004 Sandia Corporation. Under the terms of Contract
# DE-AC04-94AL85000, there is a non-exclusive license for use of this
# work by or on behalf of the U.S. Government. Export of this program
# may require a license from the United States Government.
#

.SUFFIXES: .d

PROGRAM = FeS2_4_MPNewman_cc

BLESSED_FILES = good_out.txt FeS2_intResults_blessed.csv soln_0_0_blessed.xml outputTable_blessed.csv

DATA_FILES = FeS2_A.xml  FeS2_B.xml  FeS2_electrode.xml  LiKCl_Margules.xml  LiKCl_recipmoltenSalt.xml \
             cathode.inp Li_Liquid.xml  metal_Li_LiCl_electrons.xml problem_setup.sh

TEST_RESULTS = outputTable.csv FeS2_intResults_0_0.csv out.txt soln_0_0.xml  FeS2_globalResults_0_0.csv 

TEST_INTERMEDIATES = diff_csv.txt diff_ocsv.txt diff_out.txt err_out.txt diff_summary.txt diff_xml.txt

TEST_FLAGS = runGood runBad runInProgress.txt

OBJ = $(PROGRAM).o

##########################################################################
#           Setup The Zuzax Directory locations
#########################################################################

PURIFY=@PURIFY@

# These links are to Cantera's install space
CT_INCROOT =  @ct_incroot@

# Bring in the Zuzax includes through the .mak file
include $(CT_INCROOT)/zuzax/Zuzax.mak

# Utilsrc dependencies
UTILSRC_DIR = ../../../util_src/src
UTILSRC_DEP = $(UTILSRC_DIR)/libutil_src.a
UTILSRC     = -L$(UTILSRC_DIR) -lutil_src

# Set up the Zuzax addition library
CTPADDS_DIR = ../../../ctpadds/src
CTPADDS_DEP = $(CTPADDS_DIR)/libctpadds.a
CTPADDS_LIB = -L$(CTPADDS_DIR) -lctpadds

# Set up the Electrode  directory
CTAPPLBASE_DIR = ../../src
CTAPPLBASE_DEP =   $(CTAPPLBASE_DIR)/libElectrode.a
CTAPPLBASE_LIB = -L$(CTAPPLBASE_DIR) -lElectrode

#########################################################################
# Set up the various local and global defines
########################################################################

LDEFINES = -DDEBUG 
GDEFINES =

# Set up the global include directory macro
INCLUDE_DIRS = $(ZUZAX_TOTAL_INCLUDES) -I$(CTAPPLBASE_DIR) -I$(UTILSRC_DIR)  -I$(CTPADDS_DIR) 

all: .dependsT $(PROGRAM)

LDR = $(F77LDR)
LDRFLAGS = $(F77LDRFLAGS)
LDRFLAGS_DEBUG = -g -y $(FFLAGS_BSD)
CCFLAGS =  $(LDEFINES) $(INCLUDE_DIRS) $(GDEFINES)
#
############################################################################
# section to set up compiler rules
###########################################################################

# the C++ compiler
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
LCXX_FLAGS = @LCXX_FLAGS@
LCXX_END_LIBS = @LCXX_END_LIBS@
CXXLDR = $(CXX)


# Both the C and C++ compiler predefines
CCFLAGS =  $(GDEFINES) $(INCLUDE_DIRS) $(LDEFINES) 

.cpp.o:
	$(PURIFY) $(CXX) $(CXXFLAGS) $(CCFLAGS) -c $<

############################################################################
# section to set up depends
###########################################################################

DEPENDS = $(OBJ:.o=.d) 

.cpp.d:
	@CXX_DEPENDS@ $(CXXFLAGS) $(CCFLAGS) -c $*.cpp > $*.d

depends:
	$(RM) $(DEPENDS)
	$(MAKE) .dependsT

.dependsT: $(DEPENDS)
	cat *.d > .depends
	touch .dependsT

test: 
	@$(MAKE) -s
	@echo -n 'Checking need to run test ' $(PROGRAM) ': '
	@$(MAKE) -q -s  runGood ; ss=$$? ; if test $$ss = "0" ; then echo '   NOT NEEDED' ; else  $(MAKE) -s runGood ; fi

runGood: $(PROGRAM) $(DATA) $(BLESSED_FILES)
	@echo 'RUNNING TEST ' $(PROGRAM)
	../runtest_Electrode

rebaseline:
	cp FeS2_intResults_0_0.csv FeS2_intResults_blessed.csv
	cp out.txt good_out.txt
	cp soln_0_0.xml soln_0_0_blessed.xml
	cp outputTable.csv  outputTable_blessed.csv 

$(OBJ): Makefile
$(DEPENDS): Makefile

$(PROGRAM): $(OBJ) $(OBJ_ZUZAX_ADDONS) $(UTILSRC_DEP) \
               $(ZUZAX_CORE_LIBS_DEP) $(CTPADDS_DEP) $(CTAPPLBASE_DEP)
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o $(PROGRAM) $(OBJ) \
	          $(OBJ_ZUZAX_ADDONS)  \
                  $(CTAPPLBASE_LIB) $(CTPADDS_LIB) $(UTILSRC) $(ZUZAX_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

install:

clean:
	$(RM) *.o  .depends *.d *~  $(PROGRAM) .dependsT
	$(RM) ${PROG} $(TEST_FLAGS)

dist_clean:
	$(MAKE) clean_dist

clean_test:
	$(RM) $(TEST_FLAGS) $(TEST_RESULTS) $(TEST_INTERMEDIATES)

clean_dist:
	$(MAKE) clean
	$(MAKE) clean_test

clean_test_flags:
	$(RM) $(TEST_FLAGS)

ifeq ($(wildcard .depends), .depends)
include .depends
endif


