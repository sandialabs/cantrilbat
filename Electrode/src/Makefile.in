#
#  Makefile.in: 
#
.SUFFIXES: .d

#
RM = /bin/rm -f
CP = /bin/cp -f -p
AR = ar
RANLIB = ranlib
F77 = g77
FTCHECK = -u
F77MLDRFLAGS =
CMLDRFLAGS =
MPIHOME  = /usr/local/mpich
MPI_INC = -I$(MPIHOME)/include
MPI_LIB = -L/usr/local/mpich/lib -lmpich -lpmpich
#
# These links are to Zuzax's install space
ZZ_INCROOT =  @ct_incroot@
#
# Bring in the Zuzax includes through the .mak file
#
include $(ZZ_INCROOT)/zuzax/Zuzax.mak


# The directory where Zuzax include files may be found.
ZUZAX_INCROOT=@ct_incroot@

PURIFY=@PURIFY@

# Find the Build root for Zuzax 
#
ZUZAX_BUILD_ROOT=@ctb_root@
#
CTPADDSSRC_DIR=../../ctpadds/src

UTILSRC_DIR = ../../util_src/src
UTILSRC_DEP = $(UTILSRC_DIR)/libutil_src.a
UTILSRC     = -L$(UTILSRC_DIR) -lutil_src


F2C_INC=$(ZUZAX_INCROOT)/cantera
#
# Set up the various local and global defines
#
# LDEFINES =   -DDEBUG_ELECTRODE
#       Useful for adding more debugging to new models
# LDEFINES =   -DDEBUG_NEWMODELS
#       Useful IO for debugging mole conservation issues in the radial models - prints out a file
# LDEFINES =   -DDEBUG_MASSLOSS -DDEBUG_MODE
# LDEFINES =   -DDEBUG_MODE_PREDICTION -DDEBUG_HKM
#       Temporary IO for debugging thermal terms
# LDEFINES =   -DDEBUG_THERMAL
#       Temporary IO for debugging OCV calcualtion
# LDEFINES =   -DDEBUG_OCV
#
# Set up the global include directory macro
#
INCLUDE_DIRS = $(CANTERA_TOTAL_INCLUDES) \
               -I$(CTPADDSSRC_DIR) \
               -I$(UTILSRC_DIR) 
#
# the C++ compiler
#
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
LCXX_FLAGS = @LCXX_FLAGS@
LCXX_END_LIBS = @LCXX_END_LIBS@
CXXLDR = $(CXX)

# C compiler
CFLAGS = @CXXFLAGS@

# Both the C and C++ compiler predefines
CCFLAGS = $(GDEFINES) $(INCLUDE_DIRS) $(LDEFINES) 

all: .depends libElectrode.a

allsrc: .depends libElectrode.a

.cpp.o:
	$(PURIFY) $(CXX) $(CXXFLAGS) $(CCFLAGS) -c $<

LDR = $(F77LDR)
LDRFLAGS = $(F77LDRFLAGS)
LDRFLAGS_DEBUG = -g -y $(FFLAGS_BSD)
INSTALL_TSC = @abs_top_builddir@/bin/install_tsc

CCFLAGS = $(LDEFINES) $(INCLUDE_DIRS) $(GDEFINES)


OBJ_CTAPPLBASE =  ReactingSurDomain.o RSD_OCVmodel.o \
                  Electrode.o Electrode_input.o ApplBase_print.o Electrode_Polarization.o \
	          Electrode_SimplePhaseChangeDiffusion.o Electrode_Exception.o  \
                  Electrode_InfCapacity.o Electrode_MP_RxnExtent.o Electrode_Factory.o \
                  Electrode_CSTR.o Electrode_Capacity.o  Electrode_CSTR_MCMBAnode.o \
                  Electrode_CSTR_LiCoO2Cathode.o EState.o EState_RadialDistrib.o Electrode_XMLWriter.o \
                  Electrode_Integrator.o Electrode_SimpleDiff.o Electrode_DiffTALE.o \
                  Electrode_RadialDiffRegions.o Electrode_RadialRegion.o Electrode_SurfaceRegion.o \
                  Electrode_Equilibrium.o Electrode_Jacobian.o \
                  Electrode_MP_RxnExtent_FeS2.o Electrode_FD_Jacobian.o EState_XML.o \
                  GFCEO_Electrode.o

HDR_CTAPPLBASE =   ReactingSurDomain.h RSD_OCVmodel.h \
                  Electrode.h Electrode_input.h ApplBase_print.h Electrode_defs.h Electrode_Polarization.h \
	          Electrode_SimplePhaseChangeDiffusion.h  Electrode_Exception.h \
                  Electrode_InfCapacity.h Electrode_MP_RxnExtent.h Electrode_Factory.h \
                  Electrode_CSTR.h Electrode_CSTR_MCMBAnode.h \
                  Electrode_CSTR_LiCoO2Cathode.h EState.h Electrode_FuncCurrent.h  EState_RadialDistrib.h \
                  Electrode_Integrator.h Electrode_SimpleDiff.h Electrode_DiffTALE.h \
                  Electrode_RadialDiffRegions.h  Electrode_RadialRegion.h Electrode_SurfaceRegion.h \
                  Electrode_Equilibrium.h \
                  Electrode_MP_RxnExtent_FeS2.h Electrode_Jacobian.h Electrode_FD_Jacobian.h EState_XML.h \
                  GFCEO_Electrode.h

CPP_CTAPPLBASE =  $(OBJ_CTAPPLBASE:.o=.cpp)

###########################################################################
# section to set up depends
###########################################################################
DEPENDS = $(OBJ_CTAPPLBASE:.o=.d)

.f.d:
	echo "$*.o: $*.f" > $*.d

.cpp.d:
	@CXX_DEPENDS@ $(CXXFLAGS) $(CCFLAGS) -c $*.cpp > $*.d

.c.d:
	@CXX_DEPENDS@ $(CXXFLAGS) $(CCFLAGS) -c $*.c > $*.d

ctmlDiff: ctmlDiff.o $(UTILSRC_DEP) \
          $(CANTERA_CORE_LIBS_DEP)
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o ctmlDiff ctmlDiff.o \
                  $(UTILSRC) $(CANTERA_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

############################################################################

$(DEPENDS): Makefile $(HDR_CTAPPLBASE) 
%.d: $*.cpp

$(OBJ_CTAPPLBASE): Makefile 

libElectrode.a: $(OBJ_CTAPPLBASE)
	$(AR) rv libElectrode.a $(OBJ_CTAPPLBASE)

depends:
	$(RM) *.d .depends
	$(MAKE) .depends

.depends: $(DEPENDS)
	cat *.d > .depends

test:
	$(MAKE) -s all
	cd .. ; $(MAKE) test

###########################################################################
#          INSTALL RULES
###########################################################################

install:
	$(MAKE) all
	@INSTALL@ -d @cta_incdir@
	@INSTALL@ -d @cta_libdir@
	@for iFile in $(HDR_CTAPPLBASE) ; do               \
           $(INSTALL_TSC) $${iFile} @cta_incdir@/$${iFile}        ;     \
        done
	$(INSTALL_TSC)  libElectrode.a @cta_libdir@


ifeq ($(wildcard .depends), .depends)
include .depends
endif

clean:
	$(RM) *.o *.prj lib*.a ftn[012345]* save save.dat dum \
                   fort.* *%  core *.trace tmp* *.d
	$(RM) ${PROG}  .depends

clean_dist:
	$(MAKE) clean
	@for iFile in $(HDR_CTAPPLBASE) ; do               \
           echo "/bin/rm -f @cta_incdir@/$${iFile}" ;     \
           /bin/rm -f @cta_incdir@/$${iFile}        ;     \
	done
	/bin/rm -f @cta_libdir@/libElectrode.a

