#!/bin/sh
#
# Copywrite 2004 Sandia Corporation. Under the terms of Contract
# DE-AC04-94AL85000, there is a non-exclusive license for use of this
# work by or on behalf of the U.S. Government. Export of this program
# may require a license from the United States Government.

.SUFFIXES: .d

##########################################################################
#           Setup The Zuzax Directory locations
#########################################################################

PURIFY=@PURIFY@

# These links are to Cantera's install space
CT_INCROOT =  @ct_incroot@

# Bring in the Zuzax includes through the .mak file
include $(CT_INCROOT)/zuzax/Zuzax.mak

UTILSRC_DIR = ../../util_src/src
UTILSRC_DEP = $(UTILSRC_DIR)/libutil_src.a
UTILSRC     = -L$(UTILSRC_DIR) -lutil_src

# Set up the Zuzax addition library
CTPADDS_DIR = ../../ctpadds/src
CTPADDS_DEP = $(CTPADDS_DIR)/libctpadds.a
CTPADDS_LIB = -L$(CTPADDS_DIR) -lctpadds

# Set up the Zuzax Application Base directory
CTAPPLBASE_DIR = ../../Electrode/src
CTAPPLBASE_DEP =   $(CTAPPLBASE_DIR)/libElectrode.a
CTAPPLBASE_LIB = -L$(CTAPPLBASE_DIR) -lElectrode

LDEFINES = -DDEBUG 
GDEFINES =

# Set up the global include directory macro
INCLUDE_DIRS = $(CANTERA_TOTAL_INCLUDES) -I$(CTAPPLBASE_DIR) -I$(UTILSRC_DIR)  -I$(CTPADDS_DIR) 

all: .depends electrodeCell

allsrc: .depends electrodeCell

LDR = $(F77LDR)
LDRFLAGS = $(F77LDRFLAGS)
LDRFLAGS_DEBUG = -g -y $(FFLAGS_BSD)

CCFLAGS =   $(LDEFINES) $(INCLUDE_DIRS) $(GDEFINES)

OBJ_MPEQUIL= electrodeCell_main.o electrodeCell_prep.o cell_input.o electrodeCell_kin.o \
               electrodeCell_findI.o

# the C++ compiler
CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
LCXX_FLAGS = @LCXX_FLAGS@
LCXX_END_LIBS = @LCXX_END_LIBS@
CXXLDR = $(CXX)

# C compiler
CC = @CC@
CFLAGS = @CXXFLAGS@

# Both the C and C++ compiler predefines
CCFLAGS =  $(GDEFINES) $(INCLUDE_DIRS) $(LDEFINES) 

.cpp.o:
	$(PURIFY) $(CXX) $(CXXFLAGS) $(CCFLAGS) -c $<

DEPENDS = $(OBJ_MPEQUIL:.o=.d) 

.cpp.d:
	@CXX_DEPENDS@ $(CXXFLAGS) $(CCFLAGS) -c $*.cpp > $*.d

depends:
	$(RM) $(DEPENDS)
	$(MAKE) .depends

.depends: $(DEPENDS)
	cat *.d > .depends

test:
	cd .. ; $(MAKE) test

$(OBJ_MPEQUIL): Makefile
$(DEPENDS): Makefile

electrodeCell: $(OBJ_MPEQUIL)  $(UTILSRC_DEP) \
               $(CANTERA_CORE_LIBS_DEP) $(CTPADDS_DEP) $(CTAPPLBASE_DEP)
	$(PURIFY) $(CXXLDR) $(LCXX_FLAGS) -o electrodeCell $(OBJ_MPEQUIL) \
                  $(CTAPPLBASE_LIB) $(CTPADDS_LIB) $(UTILSRC) $(CANTERA_TOTAL_LIBS) \
                  $(LCXX_END_LIBS) 

install:
	$(MAKE) all
	@INSTALL@ -d @cta_bindir@
	@INSTALL@ -c electrodeCell @cta_bindir@

clean:
	$(RM) *.o  .depends *.d *~  electrodeCell

ifeq ($(wildcard .depends), .depends)
include .depends
endif

