#!/bin/sh
#
#  Makefile.in: 
#
#
# Copywrite 2004 Sandia Corporation. Under the terms of Contract
# DE-AC04-94AL85000, there is a non-exclusive license for use of this
# work by or on behalf of the U.S. Government. Export of this program
# may require a license from the United States Government.
#

.SUFFIXES: .d

PROGRAM = mpequil
TESTNAME = mpequil_she_electrode

TOPDIR = @abs_top_srcdir@

BASE_PROGRAM=../../src/mpequil

BLESSED_FILES = good_out.txt vcs_equilibrate_blessed.csv 
BLESSED_DEBUG_FILES = good_dout.txt vcs_equilibrate_blessed.csv 

DATA = mpequil.inp problem_setup.sh \
       h2gas.xml  HMW_NaCl_sp1977_alt.xml  HMW_NaCl.xml  Pt_H2electrons.xml

all:   mpequil

mpequil:
	ln -s ../../src/mpequil .

test: 
	@$(MAKE) -s
	@echo -n 'Checking need to run test ' $(TESTNAME) ': '
	@$(MAKE) -q -s  runGood ; ss=$$? ; if test $$ss = "0" ; then echo '   NOT NEEDED' ; else  $(MAKE) -s runGood ; fi

testd: 
	@$(MAKE) -s
	@echo -n 'Checking need to run test ' $(TESTNAME)"_debug" ': '
	@$(MAKE) -q -s  runGood_debug ; ss=$$? ; if test $$ss = "0" ; then echo '   NOT NEEDED' ; else  $(MAKE) -s runGood_debug ; fi

runGood: $(BASE_PROGRAM) $(PROGRAM) $(DATA) Makefile $(BLESSED_FILES)
	@echo 'RUNNING TEST ' $(TESTNAME)
	/bin/rm -f runGood_release
	$(TOPDIR)/bin/runtest_Exec

runGood_debug: $(BASE_PROGRAM) $(PROGRAM) $(DATA) Makefile $(BLESSED_DEBUG_FILES)
	if test -e "runGood" ; then cp runGood runGood_release ; fi
	@echo 'RUNNING TEST ' $(TESTNAME)"_debug"
	$(TOPDIR)/bin/runtest_Exec -i problem_setup_d.sh
	if test -e "runGood" ; then cp runGood runGood_debug ; fi
	if test -e "runGood_release" ; then mv runGood_release runGood ; fi
        
rebaseline:
	if test -e out.txt ; then cp out.txt good_out.txt ; fi
	cp vcs_equilibrate_res.csv vcs_equilibrate_blessed.csv
	if test -e dout.txt ; then cp dout.txt good_dout.txt ; fi

clean:
	$(MAKE) testclean

testclean:
	rm -f out.txt err_out.txt  vcs_equilibrate_res.csv  diff_csv.txt  diff_out.txt err_dout.txt diff_dout.txt dout.txt\
	      runGood runBad runInProgress.txt diff_summary.txt .*swp runGood_debug runGood_release

distclean: 
	$(MAKE) testclean
	rm -f mpequil



