#!/bin/sh
#
# Copywrite 2004 Sandia Corporation. Under the terms of Contract
# DE-AC04-94AL85000, there is a non-exclusive license for use of this
# work by or on behalf of the U.S. Government. Export of this program
# may require a license from the United States Government.
#

.SUFFIXES: .d

PROGRAM = LiIon_PorousBat
TEST_NAME = LiIon_MCMB_LiCoO2

DATA =  ECsoln_ion.xml  LiCoO2Cathode_electrode.xml  LiCoO2_Margules_1.xml  Li_Metal.xml \
        MCMBAnode_electrode.xml  MCMB_RedlichKister.xml  metal_Li_LiIon_electrons.xml \
        MgO.xml  

BLESSED_FILES = BulkDomain1D_0_blessed.dat  BulkDomain1D_2_blessed.dat  SurDomain1D_0_blessed.dat \
                SurDomain1D_2_blessed.dat  timeDep_IV_blessed.dat \
                BulkDomain1D_1_blessed.dat  solution_blessed.xml \
                SurDomain1D_1_blessed.dat  SurDomain1D_3_blessed.dat

INPUT_FILES = anode.inp  cathode.inp  LiIon_PorousBat.inp

TEST_INTERMEDIATES =  out.txt  diff_IV.txt diff_*  transport_log.xml err_out.txt

TEST_RESULTS = SurDomain1D_0.dat SurDomain1D_1.dat SurDomain1D_2.dat  SurDomain1D_3.dat timeDep_IV.dat \
              solution.xml BulkDomain1D_0.dat  BulkDomain1D_1.dat  BulkDomain1D_2.dat   Capacity_Starting.dat \
              solution_multiBulk.dat  

TEST_FLAGS =  runGood runBad runInProgress.txt

##########################################################################
#           Setup The Zuzax Directory locations
#########################################################################

PROGRAM_ORIGIN = ../../src_LiIon_PorousBat/$(PROGRAM)

PURIFY=@PURIFY@

# These links are to Cantera's install space
CT_INCROOT =  @ct_incroot@

#
# Bring in the Zuzax includes through the .mak file
#
include $(CT_INCROOT)/zuzax/Zuzax.mak

all: $(PROGRAM)

$(PROGRAM):
	ln -s $(PROGRAM_ORIGIN) .

depends:

test:
	@$(MAKE) -s
	@echo -n 'Checking need to run test $(TEST_NAME): '
	@$(MAKE) -q -s  runGood ; ss=$$? ; if test $$ss = "0" ; then echo '   NOT NEEDED' ; else  $(MAKE) -s  runGood ; fi

runGood: $(PROGRAM_ORIGIN) $(DATA) Makefile $(BLESSED_FILES)
	@echo 'RUNNING TEST ' $(TEST_NAME)
	( export XMLSOLNDIFF=../../src_test/xmlSolnDiff ; ../runtest)

rebaseline:
	./rebaseline.sh

install:

clean:
	$(RM) $(PROGRAM)  transport_log.xml  $(TEST_FLAGS)

test_clean:
	$(RM) $(TEST_FLAGS) $(TEST_INTERMEDIATES) $(TEST_RESULTS)

clean_test:
	$(RM) $(TEST_FLAGS) $(TEST_INTERMEDIATES) $(TEST_RESULTS)

clean_testflags:
	$(RM) $(TEST_FLAGS)

dist_clean:
	$(MAKE) test_clean
	$(MAKE) clean

clean_dist:
	$(MAKE) clean
	$(MAKE) clean_test

